#!/usr/bin/env ruby
# -*- mode: ruby; coding: utf-8 -*-
# This file is part of OpenRubyRMBot.
# 
# Copyright Â© 2012 OpenRubyRMK Team
# 
# OpenRubyRMBot is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# OpenRubyRMBot is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with OpenRubyRMBot.  If not, see <http://www.gnu.org/licenses/>.
require_relative "../lib/open_ruby_rmbot"

# Whether to use debug mode. You can set this either by
# invoking the Ruby interpreter in debug mode, or by passing
# the `-d' option to OpenRubyRMBot.
debug_mode = $DEBUG

until ARGV.empty?
  case arg = ARGV.shift
  when "-d", "--debug" then
    debug_mode = true
  when "-D", "--debug-all" then
    debug_mode = :all
  when "-v", "--version" then
    puts <<-VERSION
This is OpenRubyRMBot, version #{OpenRubyRMBot::VERSION}.
Copyright (C) 2012 The OpenRubyRMK team.
This program comes with ABSOLUTELY NO WARRANTY; for details see the
file COPYING in the sources.
This is free software, and you are welcome to redistribute it
under certain conditions; see the COPYING file for further
information on this.
    VERSION
    exit
  when "-h", "--help" then
    puts <<-HELP
OpenRubyRMBot, the IRC bot from the OpenRubyRMK team.
Version: #{OpenRubyRMBot::VERSION}

Options:

Short  Long         Description
=======================================================================
-d     --debug      Enable debug mode, i.e. log to standard output with
                    loglevel DEBUG and do not daemonise.
-D     --debug-all  As --debug, but activates the underlying em-irc
                    logger as well (Warning: masses of output).
-h     --help       Display this message and exit.
-v     --version    Display the version and copyright information,
                    then  exit.

OpenRubyRMBot understands the following process signals:

Signal  Effect
===================================
SIGINT   Graceful shutdown the bot.
SIGTERM  Graceful shutdown the bot.


Exit statuses:

Code  Description
=============================================
0     Everything OK.
1     Unknown commandline option encountered.
2     A plugin couldn't be found.
3     PID file already exists.
    HELP
    exit
  else
    puts "Unknown option #{arg}. Try -h for help."
    exit 1
  end
end

if debug_mode
  OpenRubyRMBot::IRCBot.new(debug_mode).run!
else
  fork{OpenRubyRMBot::IRCBot.new(debug_mode).run!}
end
