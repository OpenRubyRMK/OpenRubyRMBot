#!/usr/bin/env ruby
# -*- mode: ruby; coding: utf-8 -*-
require "mkfifo"
require "cinch"

module CinchPlugins
end

Dir["plugins/*.rb"].each{|f| require_relative(f)}

cinch = Cinch::Bot.new do

  configure do |config|
    config.server     = "irc.freenode.net"
    config.port       = 6697
    config.ssl.use    = true
    config.ssl.verify = false

    config.channels = ["#OpenRubyRMKBotTest"]
    config.nick     = "OpenRubyRMBot"
    config.user     = "orrbot"
    config.realname = "OpenRubyRMBot"

    config.plugins.options[CinchPlugins::Fifo] = {
      :fifo_path => "/tmp/myfifo"
    }

    config.plugins.plugins = CinchPlugins.constants.map{|sym| CinchPlugins.const_get(sym)}
  end

  trap "SIGINT" do
    bot.log("Cought SIGINT, quitting...", :info)
    bot.quit
  end

  trap "SIGTERM" do
    bot.log("Cought SIGTERM, quitting...", :info)
    bot.quit
  end

end

cinch.start
